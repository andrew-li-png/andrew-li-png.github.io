<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Operation Orchid — picoCTF Forensics</title>

  <!-- Shared CSS/JS -->
  <link rel="stylesheet" href="../../../assets/styles.css" />
  <script defer src="../../../assets/site.js"></script>
</head>

<body>
  <div class="container">
    <header>
      <div class="tagline breadcrumbs">
        <a class="crumb" href="../../../index.html">Home</a>
        <a class="crumb" href="../../index.html">picoCTF</a>
        <a class="crumb" href="../index.html">Forensics</a>
        <span class="crumb-current">Operation Orchid</span>
      </div>

      <h1>Operation Orchid</h1>
      <p class="badges">
        <span class="badge">Disk Image</span>
        <span class="badge">SleuthKit</span>
        <span class="badge">mmls</span>
        <span class="badge">fls</span>
        <span class="badge">icat</span>
        <span class="badge">openssl</span>
      </p>

      <p class="muted">
        Goal: Recover the flag from a disk image by locating an encrypted flag file, extracting the encryption password from shell history, and decrypting it with OpenSSL.
      </p>
    </header>

    <div class="card">
      <h2>Challenge Description</h2>

      <p class="muted">Screenshot from the picoCTF challenge page:</p>

      <div class="screenshot">
        <img
          src="./operation_orchid/challenge.png"
          alt="Screenshot of the picoCTF challenge description for Operation Orchid"
        />
      </div>
    </div>

    <div class="card">
      <h2>Challenge Overview</h2>
      <p>
        This is a disk image forensics challenge. The trick is that the flag isn’t sitting in plaintext — it’s stored as an encrypted file,
        and the password is leaked in the user’s shell history (<code>.ash_history</code>).
      </p>
      <p>
        Workflow: decompress the image, identify the Linux partition/offset, browse the filesystem with SleuthKit, pull the encrypted file + history,
        then decrypt using the recovered password.
      </p>
    </div>

    <div class="card">
      <h2>Solution</h2>

      <h3>1) Decompress and find the Linux partition offset</h3>
      <p>
        After downloading the <code>.gz</code>, decompress it, then list partitions with <code>mmls</code>.
        The partition we care about starts at sector <code>411648</code>, which becomes the offset used for all SleuthKit file listing/extraction.
      </p>

      <pre><code>gunzip disk.flag.img.gz
mmls disk.flag.img
fls -o 411648 disk.flag.img</code></pre>

      <div class="screenshot">
        <img
          src="./operation_orchid/step-01.png"
          alt="Terminal output showing mmls listing partitions and identifying the partition start (offset) used for analysis"
        />
      </div>

      <h3>2) Browse the filesystem and locate the encrypted flag + command history</h3>
      <p>
        List the filesystem with <code>fls</code> using the offset. From there, check the root directory (inode <code>472</code>).
        In root, you’ll find:
        <code>flag.txt.enc</code> (encrypted flag) and <code>.ash_history</code> (shell history with the encryption command + password).
      </p>

      <pre><code>fls -o 411648 disk.flag.img 472
icat -o 411648 disk.flag.img 1875</code></pre>

      <div class="screenshot">
        <img
          src="./operation_orchid/step-02.png"
          alt="Terminal output showing fls navigation into the root directory and icat dumping .ash_history which contains the openssl encryption command and password"
        />
      </div>

      <h3>3) Extract the encrypted flag to your machine</h3>
      <p>
        Now that we know the inode for the encrypted file (<code>flag.txt.enc</code>), use <code>icat</code> to save it locally.
      </p>

      <pre><code>icat -o 411648 disk.flag.img 1782 &gt; flag.txt.enc
ls</code></pre>

      <div class="screenshot">
        <img
          src="./operation_orchid/step-03.png"
          alt="Terminal output showing icat extracting flag.txt.enc from the disk image into a local file"
        />
      </div>

      <h3>4) Decrypt with the leaked password (even if it prints “bad decrypt”)</h3>
      <p>
        The shell history shows the exact OpenSSL command used to encrypt the flag, including the password.
        To decrypt, add <code>-d</code> and swap the input/output files accordingly.
      </p>

      <pre><code>openssl aes256 -d -salt -in flag.txt.enc -out flag.txt -k unbreakablepassword1234567
cat flag.txt</code></pre>

      <p class="muted">
        Note: OpenSSL may print <code>bad decrypt</code>, but it still outputs a readable <code>flag.txt</code> here.
      </p>

      <div class="screenshot">
        <img
          src="./operation_orchid/step-04.png"
          alt="Terminal output showing openssl decryption producing flag.txt and cat revealing the picoCTF flag"
        />
      </div>

      <h3>Flag</h3>
      <p>
        <code>picoCTF{h4un71ng_p457_5113beab}</code>
      </p>
    </div>

    <div class="card">
      <h2>Tools Used</h2>
      <ul>
        <li><code>gunzip</code> (decompress the provided disk image)</li>
        <li><code>mmls</code> (identify partitions + find the correct offset)</li>
        <li><code>fls</code> (browse directories/inodes in the filesystem)</li>
        <li><code>icat</code> (extract files from the image by inode)</li>
        <li><code>openssl</code> (decrypt <code>flag.txt.enc</code> using the leaked password)</li>
      </ul>
    </div>

    <footer>
      <p>Write-up by Andrew Li</p>
    </footer>
  </div>
</body>
</html>
