<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Corrupted File – picoCTF Write-up</title>

  <!-- Same stylesheet used for Hidden in plainsight / Flag in Flame -->
  <link rel="stylesheet" href="../../../assets/styles.css" />
</head>

<body>
  <div class="container">
    <header>
      <div class="tagline breadcrumbs">
        <a class="crumb" href="../../../index.html">Home</a>
        <a class="crumb" href="../../index.html">picoCTF</a>
        <a class="crumb" href="../index.html">Forensics</a>
        <span class="crumb-current">Corrupted File</span>
      </div>

      <h1>Corrupted File</h1>

      <!-- Tool-focused tags -->
      <p class="badges">
        <span class="badge">file</span>
        <span class="badge">Hex Editor</span>
        <span class="badge">JPEG</span>
      </p>

      <p class="muted">Broken header → fixed magic bytes → recovered image.</p>
    </header>

    <div class="card">
      <!-- Challenge Description -->
      <section>
        <h2>Challenge Description</h2>

        <p class="muted">Screenshot from the picoCTF challenge page:</p>

        <div class="screenshot">
          <img
            src="./corrupted_file/challenge.png"
            alt="picoCTF Corrupted File challenge description screenshot"
            loading="lazy"
          />
        </div>

        <p>
          The challenge gives you a file that appears broken. The hint suggests that
          “a couple of bytes” might be all it takes to bring it back to life.
        </p>
      </section>
    </div>

    <div class="card">
      <!-- Challenge Overview -->
      <section>
        <h2>Challenge Overview</h2>
        <p>
          This challenge boils down to file signatures. Even though the file command didn’t
          recognize it, inspecting the raw bytes revealed JPEG markers. Fixing the incorrect
          magic bytes restored the image and revealed the flag.
        </p>
      </section>
    </div>

    <div class="card">
      <!-- Solution -->
      <section>
        <h2>Solution</h2>

        <ol class="steps">
          <li>
            <strong>Check the file type and inspect the header.</strong>
            <p>
              Running <code>file</code> didn’t tell us much, so I checked the first few bytes directly.
              Seeing <code>JFIF</code> in the header was the big clue that this was supposed to be a JPEG.
            </p>

            <pre><code>cat file | head</code></pre>

            <div class="screenshot">
              <img
                src="./corrupted_file/jfif_head.png"
                alt="Terminal output showing JFIF string in the file header"
                loading="lazy"
              />
            </div>
          </li>

          <li>
            <strong>Inspect and fix the magic bytes in a hex editor.</strong>
            <p>
              I opened the file in a hex editor and checked the magic bytes.
              A valid JPEG should start with <code>FF D8</code>, but this file started with <code>5C 78</code>.
            </p>

            <p>
              I changed the first two bytes to <code>FF D8</code> and saved the file.
            </p>

            <div class="screenshot">
              <img
                src="./corrupted_file/hexedit.png"
                alt="Hex editor view showing incorrect magic bytes before being fixed"
                loading="lazy"
              />
            </div>
          </li>

          <li>
            <strong>Rename the file and open the recovered image.</strong>
            <p>
              After fixing the header, I renamed the file to give it the proper extension.
            </p>

            <pre><code>mv file file.jpg</code></pre>

            <p>
              Opening the image now worked perfectly, and the flag was clearly visible.
            </p>

            <div class="screenshot">
              <img
                src="./corrupted_file/recovered_image.jpg"
                alt="Recovered JPEG image showing the picoCTF flag"
                loading="lazy"
              />
            </div>
          </li>
        </ol>

        <div class="note">
          <strong>Quick takeaway</strong>
          <p class="muted">
            When a file looks “broken,” always check the magic bytes.
            A single incorrect header value can prevent tools from recognizing an otherwise valid file.
          </p>
        </div>
      </section>
    </div>

    <div class="card">
      <!-- Tools Used -->
      <section>
        <h2>Tools Used</h2>
        <ul class="tools">
          <li><strong>file</strong> — initial file type inspection</li>
          <li><strong>Hex editor</strong> — fix incorrect magic bytes</li>
          <li><strong>Image viewer</strong> — open the repaired JPEG</li>
        </ul>
      </section>
    </div>

    <footer>
      <p>Write-up by Andrew Li</p>
    </footer>
  </div>

  <script src="../../../assets/site.js" defer></script>
</body>
</html>
